#include <emmintrin.h>
#include <immintrin.h>
#include <intrin.h>
#include <iostream>


#define ARR_SIZE 4096
#define VAL 50


static float* getRandArr()
{
    auto res = new float[ARR_SIZE];
    for (int i = 0; i < ARR_SIZE; ++i) {
        res[i] = rand() % (VAL * 2);
    }
    return res;
}


auto scalar(float* a, float* b, float* c)
{
    for (int i = 0; i < ARR_SIZE; ++i)
    {
        c[i] = a[i] + b[i];
    }
}

auto simd(float* a, float* b, float* c)
{
    for (int i = 0; i < ARR_SIZE; i += 4)
    {
        auto loaded_a = _mm_loadu_ps(&a[i]);
        auto loaded_b = _mm_loadu_ps(&b[i]);
        _mm_storeu_ps(&c[i], _mm_add_ps(loaded_a, loaded_b));
    }
}

void main()
{
    static auto a = getRandArr();
    static auto b = getRandArr();
    auto c = new float[ARR_SIZE];
    scalar(a, b, c);
    std::cout << a[0] << "+" << b[0] << "=" << c[0] << std::endl;
}
